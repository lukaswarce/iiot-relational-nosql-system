# ==============================================================================
# MOSQUITTO ACL (Access Control List) - EJEMPLO PARA PRODUCCIÓN
# ==============================================================================
# Este archivo define reglas de acceso a topics MQTT por usuario.
# 
# IMPORTANTE: Este archivo NO está activo en la configuración educativa actual.
# Para activarlo, descomentar "acl_file" en mosquitto.conf
#
# Documentación: https://mosquitto.org/man/mosquitto-conf-5.html
# ==============================================================================

# ------------------------------------------------------------------------------
# SINTAXIS BÁSICA
# ------------------------------------------------------------------------------
# user <username>           - Define el usuario
# topic [read|write|readwrite] <topic>  - Define permisos en un topic
# pattern [read|write|readwrite] <pattern>  - Define permisos con patrón
#
# Wildcards:
#   + (plus)  - Un nivel de jerarquía
#   # (hash)  - Múltiples niveles de jerarquía
#   %u        - Sustituido por el username
#   %c        - Sustituido por el client ID
# ------------------------------------------------------------------------------

# ------------------------------------------------------------------------------
# USUARIO ANÓNIMO (Sin Autenticación)
# ------------------------------------------------------------------------------
# En modo educativo (allow_anonymous true), estas reglas aplican a todos

# Lectura en topics del sistema (estadísticas del broker)
topic read $SYS/#

# Lectura/escritura en topics de sensores
topic readwrite iiot/sensors/#

# Lectura/escritura en topics de producción
topic readwrite iiot/production/#

# Lectura/escritura en topics de alertas
topic readwrite iiot/alerts/#

# Lectura/escritura en topics de Factory I/O
topic readwrite iiot/factory_io/#

# ------------------------------------------------------------------------------
# EJEMPLO: USUARIO ADMINISTRADOR (PRODUCCIÓN)
# ------------------------------------------------------------------------------
# Descomentar estas líneas en producción y crear usuario:
# docker exec -it iiot-mosquitto mosquitto_passwd -c /mosquitto/config/passwd admin

# user admin
# topic readwrite #
# Acceso completo a todos los topics

# ------------------------------------------------------------------------------
# EJEMPLO: USUARIO SENSOR (PRODUCCIÓN)
# ------------------------------------------------------------------------------
# Usuario solo puede publicar datos, no suscribirse

# user sensor_device
# topic write iiot/sensors/#
# topic write iiot/production/#

# ------------------------------------------------------------------------------
# EJEMPLO: USUARIO MONITOR (PRODUCCIÓN)
# ------------------------------------------------------------------------------
# Usuario solo puede leer datos, no publicar

# user monitor_user
# topic read iiot/sensors/#
# topic read iiot/production/#
# topic read iiot/alerts/#

# ------------------------------------------------------------------------------
# EJEMPLO: USUARIO PLC (PRODUCCIÓN)
# ------------------------------------------------------------------------------
# PLC puede leer comandos y escribir estados

# user plc_controller
# topic read iiot/commands/#
# topic write iiot/status/#
# topic write iiot/sensors/#

# ------------------------------------------------------------------------------
# EJEMPLO: TOPICS PRIVADOS POR USUARIO (PRODUCCIÓN)
# ------------------------------------------------------------------------------
# Cada usuario solo puede acceder a sus propios topics

# pattern readwrite iiot/users/%u/#
# Ejemplo: usuario "juan" solo accede a iiot/users/juan/

# ------------------------------------------------------------------------------
# EJEMPLO: DENEGAR ACCESO A TOPICS ADMINISTRATIVOS (PRODUCCIÓN)
# ------------------------------------------------------------------------------
# Denegar acceso a topics críticos

# user guest
# topic read iiot/sensors/temperature
# topic deny iiot/admin/#
# topic deny iiot/config/#

# ==============================================================================
# NOTAS PARA INSTRUCTORES
# ==============================================================================
#
# ACTIVAR ACL EN PRODUCCIÓN:
# --------------------------
# 1. Crear archivo de contraseñas:
#    docker exec -it iiot-mosquitto mosquitto_passwd -c /mosquitto/config/passwd admin
#
# 2. Configurar mosquitto.conf:
#    allow_anonymous false
#    password_file /mosquitto/config/passwd
#    acl_file /mosquitto/config/acl.conf
#
# 3. Reiniciar Mosquitto:
#    docker-compose restart mosquitto
#
# CASOS DE USO EDUCATIVOS:
# ------------------------
# - Demostrar seguridad en IIoT (quien puede leer/escribir qué)
# - Simular roles: operador, administrador, dispositivo
# - Ejercicio: configurar ACL para planta con múltiples áreas
#
# TESTING ACL:
# ------------
# Probar con usuario específico:
#   mosquitto_pub -h localhost -u admin -P adminpass -t test -m "mensaje"
#
# Verificar acceso denegado:
#   mosquitto_sub -h localhost -u guest -P guestpass -t iiot/admin/config
#
# ==============================================================================
